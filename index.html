<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carnet Veterinario</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f0f0;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }
    .logo {
      text-align: center;
    }
    .logo img {
      height: 80px;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .form-row label {
      flex: 1 1 150px;
      margin-bottom: 5px;
    }
    .form-row input {
      flex: 2 1 250px;
      padding: 5px;
    }
    select {
      width: 100%;
      padding: 8px;
      margin: 15px 0;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 5px;
      text-align: center;
    }
    .btn {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    @media (max-width: 600px) {
      .form-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="logo.png" alt="Logo Veterinario" />
    </div>
    <h2>REGISTRO CLÍNICO VETERINARIO</h2>

    <div class="form-row">
      <label>Especie: <input type="text" id="especie"></label>
      <label>Nombre: <input type="text" id="nombre"></label>
      <label>Sexo: <input type="text" id="sexo"></label>
      <label>Edad: <input type="text" id="edad"></label>
      <label>Propietario: <input type="text" id="propietario"></label>
      <label>Teléfono: <input type="text" id="telefono"></label>
      <label>Dirección: <input type="text" id="direccion"></label>
    </div>

    <label for="tipo">Tipo de Reporte:</label>
    <select id="tipo">
      <option value="vacunacion">Vacunación</option>
      <option value="desparasitacion">Desparasitación</option>
    </select>

    <table id="tabla-datos">
      <thead>
        <tr>
          <th id="col1">Fecha</th>
          <th id="col2">Vacunas / Producto</th>
          <th id="col3">Próxima</th>
          <th id="col4">Peso</th>
          <th id="col5">Firma MV</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" /></td>
          <td><input type="text" /></td>
          <td><input type="text" /></td>
          <td><input type="text" /></td>
          <td><input type="text" /></td>
        </tr>
      </tbody>
    </table>

    <button class="btn" onclick="generarCarnet()">Generar PDF</button>
  </div>

  <script>
    document.getElementById("tipo").addEventListener("change", () => {
      const tipo = document.getElementById("tipo").value;
      const col1 = document.getElementById("col1");
      const col2 = document.getElementById("col2");
      const col3 = document.getElementById("col3");

      if (tipo === "vacunacion") {
        col1.textContent = "Fecha Vacunación";
        col2.textContent = "Vacunas";
        col3.textContent = "Próx. Vacuna";
      } else {
        col1.textContent = "Fecha Desparasitación";
        col2.textContent = "Producto";
        col3.textContent = "Próx. Desparasitación";
      }
    });

    async function generarCarnet() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');

      const tipo = document.getElementById("tipo").value;
      const especie = document.getElementById("especie").value;
      const nombre = document.getElementById("nombre").value;
      const sexo = document.getElementById("sexo").value;
      const edad = document.getElementById("edad").value;
      const propietario = document.getElementById("propietario").value;
      const telefono = document.getElementById("telefono").value;
      const direccion = document.getElementById("direccion").value;

      // Agregar logo local
      const logo = new Image();
      logo.src = "logo.png";

      logo.onload = function () {
        doc.addImage(logo, 'PNG', 40, 20, 60, 60);

        doc.setFontSize(14);
        doc.text(`REGISTRO DE ${tipo === "vacunacion" ? "VACUNACIÓN" : "DESPARASITACIÓN"}`, 150, 40);
        doc.setFontSize(10);
        doc.text(`ESPECIE: ${especie}`, 40, 100);
        doc.text(`SEXO: ${sexo}`, 250, 100);
        doc.text(`PROPIETARIO: ${propietario}`, 400, 100);
        doc.text(`NOMBRE: ${nombre}`, 40, 120);
        doc.text(`EDAD: ${edad}`, 250, 120);
        doc.text(`TELÉFONO: ${telefono}`, 400, 120);
        doc.text(`DIRECCIÓN: ${direccion}`, 40, 140);

        const headers = [[
          document.getElementById("col1").textContent,
          document.getElementById("col2").textContent,
          document.getElementById("col3").textContent,
          document.getElementById("col4").textContent,
          document.getElementById("col5").textContent
        ]];

        const inputs = document.querySelectorAll("#tabla-datos tbody tr input");
        const rows = [];

        for (let i = 0; i < inputs.length; i += 5) {
          const row = [];
          for (let j = 0; j < 5; j++) {
            row.push(inputs[i + j].value || "");
          }
          rows.push(row);
        }

        doc.autoTable({
          startY: 160,
          head: headers,
          body: rows,
          styles: {
            fontSize: 8,
            halign: 'center'
          }
        });

        doc.save(`${nombre}_${tipo}.pdf`);
      };
    }
  </script>
</body>
</html>
